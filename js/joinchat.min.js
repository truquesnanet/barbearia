!function(t,e,n,i){"use strict";function s(){a&&a.apply(this,arguments),a=null}var a;i=t.extend({$div:null,settings:null,store:null,chatbox:!1,showed_at:0,is_ready:!1,is_mobile:!!navigator.userAgent.match(/Android|iPhone|BlackBerry|IEMobile|Opera Mini/i),can_qr:e.QrCreator&&"function"==typeof QrCreator.render},i),(e.joinchat_obj=i).$=function(e){return t(e||this.$div,this.$div)},i.send_event=function(i){var s,a,o,h;(i=t.extend({event_category:"JoinChat",event_label:"",event_action:"",chat_channel:"whatsapp",chat_id:"--",is_mobile:this.is_mobile?"yes":"no",page_location:location.href,page_title:n.title||"no title"},i)).event_label=i.event_label||i.link||"",i.event_action=i.event_action||i.chat_channel+": "+i.chat_id,delete i.link,!1!==t(n).triggerHandler("joinchat:event",[i])&&(h=e[this.settings.ga_tracker]||e.ga||e.__gaTracker,s=e[this.settings.data_layer]||e[e.gtm4wp_datalayer_name]||e.dataLayer,"function"==typeof h&&"function"==typeof h.getAll&&(h("set","transport","beacon"),h.getAll().forEach((function(t){t.send("event",i.event_category,i.event_action,i.event_label)}))),t.each(i,(function(t,e){i[t]="string"==typeof e?e.substring(0,100):e})),"function"==typeof gtag&&"object"==typeof s&&(a=this.settings.ga_event||"generate_lead",delete(o=t.extend({transport_type:"beacon"},i)).page_location,delete o.page_title,s.forEach((function(t){"config"==t[0]&&t[1]&&"G-"==t[1].substring(0,2)&&(o.send_to=t[1],gtag("event",a,o))})),this.settings.gads&&gtag("event","conversion",{send_to:this.settings.gads})),h=i.event_category,delete i.event_category,"object"==typeof s&&s.push(t.extend({event:h},i)),"function"==typeof fbq&&fbq("trackCustom",h,i))},i.whatsapp_link=function(t,e,n){return e=void 0!==e?e:this.settings.message_send||"",((n=void 0!==n?n:this.settings.whatsapp_web&&!this.is_mobile)?"https://web.whatsapp.com/send?phone=":"https://wa.me/")+encodeURIComponent(t||this.settings.telephone)+(e?(n?"&text=":"?text=")+encodeURIComponent(e):"")},i.show=function(t){this.$div.addClass("joinchat--show"+(t?" joinchat--tooltip":""))},i.hide=function(){this.$div.removeClass("joinchat--show")},i.chatbox_show=function(){this.chatbox||(this.chatbox=!0,this.showed_at=Date.now(),this.$div.addClass("joinchat--chatbox"),this.settings.message_badge&&this.$(".joinchat__badge").hasClass("joinchat__badge--in")&&this.$(".joinchat__badge").toggleClass("joinchat__badge--in joinchat__badge--out"),t(n).trigger("joinchat:show"))},i.chatbox_hide=function(){this.chatbox&&(this.chatbox=!1,this.$div.removeClass("joinchat--chatbox joinchat--tooltip"),this.settings.message_badge&&this.$(".joinchat__badge").removeClass("joinchat__badge--out"),t(n).trigger("joinchat:hide"))},i.save_hash=function(){var t=this.settings.message_hash||"none",e=(this.store.getItem("joinchat_hashes")||"").split(",").filter(Boolean);-1===e.indexOf(t)&&(e.push(t),this.store.setItem("joinchat_hashes",e.join(",")))},i.open_whatsapp=function(i,s){i=i||this.settings.telephone,s=void 0!==s?s:this.settings.message_send||"",i={link:this.whatsapp_link(i,s),chat_channel:"whatsapp",chat_id:i,chat_message:s},s=new RegExp("^https?://(wa.me|(api|web|chat).whatsapp.com|"+location.hostname.replace(".",".")+")/.*","i"),!1!==t(n).triggerHandler("joinchat:open",[i])&&(s.test(i.link)?(this.send_event(i),e.open(i.link,"joinchat","noopener")):console.error("Joinchat: the link doesn't seem safe, it must point to the current domain or whatsapp.com"))},i.optin=function(){return!this.$div.hasClass("joinchat--optout")},i.use_qr=function(){return!!this.settings.qr&&this.can_qr&&!this.is_mobile},i.qr=function(e,i){var s=n.createElement("CANVAS");return QrCreator.render(t.extend({text:e,radius:.4,background:"#FFF",size:200},this.settings.qr||{},i||{}),s),s},a=function(){if(i.$div=t(".joinchat"),i.$div.length){i.settings=i.$div.data("settings");try{localStorage.setItem("test",1),localStorage.removeItem("test"),i.store=localStorage}catch(t){i.store={_data:{},setItem:function(t,e){this._data[t]=String(e)},getItem:function(t){return this._data.hasOwnProperty(t)?this._data[t]:null}}}if("object"!=typeof i.settings)try{i.settings=JSON.parse(i.$div.attr("data-settings"))}catch(t){i.settings=void 0,console.error("Joinchat: can't get settings")}var s;i.settings&&i.settings.telephone&&(i.is_mobile||!i.settings.mobile_only?function(){t(n).trigger("joinchat:starting");var s,a,o=1e3*i.settings.button_delay,h=1e3*i.settings.message_delay,c=!!i.settings.message_hash,r=!!i.$(".joinchat__box").length,_=parseInt(i.store.getItem("joinchat_views")||1)>=i.settings.message_views,l=(i.store.getItem("joinchat_hashes")||"").split(",").filter(Boolean),g=void 0!==i.settings.is_viewed?i.settings.is_viewed:-1!==l.indexOf(i.settings.message_hash||"none");function d(){clearTimeout(a),i.chatbox_show()}function u(){i.save_hash(),i.chatbox_hide()}var p,f,m,v=!g&&(i.settings.message_badge||!c||!h||!_);function b(){var t=(n.activeElement.type||"").toLowerCase();0<=["date","datetime","email","month","number","password","search","tel","text","textarea","time","url","week"].indexOf(t)?i.chatbox?(i.chatbox_hide(),setTimeout((function(){i.hide()}),400)):i.hide():i.show()}setTimeout((function(){i.show(v)}),o),c&&h&&!g&&(i.settings.message_badge?a=setTimeout((function(){i.$(".joinchat__badge").addClass("joinchat__badge--in")}),o+h):_&&(a=setTimeout(d,o+h))),r&&!i.is_mobile&&i.$(".joinchat__button").on("mouseenter",(function(){s=setTimeout(d,1500)})).on("mouseleave",(function(){clearTimeout(s)})),i.$(".joinchat__button").on("click",(function(){r&&!i.chatbox?d():Date.now()>i.showed_at+600&&(u(),i.open_whatsapp())})),i.$(".joinchat__close").on("click",u),i.$("#joinchat_optin").on("change",(function(){i.$div.toggleClass("joinchat--optout",!this.checked)})),i.$(".joinchat__box__scroll").on("mousewheel DOMMouseScroll",(function(t){t.preventDefault(),t=t.originalEvent.wheelDelta||-t.originalEvent.detail,this.scrollTop+=30*(t<0?1:-1)})),i.is_mobile&&(t(n).on("focus blur","input, textarea",(function(e){t(e.target).closest(i.$div).length||(clearTimeout(p),p=setTimeout(b,200))})),t(e).on("resize",(function(){clearTimeout(f),f=setTimeout((function(){i.$div[0].style.setProperty("--vh",e.innerHeight+"px")}),200)})).trigger("resize")),"#joinchat"==(l=new URL(e.location)).hash&&(i.show(),setTimeout(d,700)),l.searchParams.has("joinchat")&&(c=1e3*(parseInt(l.searchParams.get("joinchat"))||0),setTimeout((function(){i.show()}),c),setTimeout(d,700+c)),t(n).on("click",'.joinchat_open, .joinchat_app, a[href="#joinchat"], a[href="#whatsapp"]',(function(e){e.preventDefault(),!r||i.optin()&&!t(this).is('.joinchat_open, a[href="#joinchat"]')?i.open_whatsapp(t(this).data("phone"),t(this).data("message")):d()})),t(n).on("click",".joinchat_close",(function(t){t.preventDefault(),i.chatbox_hide()})),r&&"IntersectionObserver"in e&&0<(_=t(".joinchat_show, .joinchat_force_show")).length&&(m=new IntersectionObserver((function(e){t.each(e,(function(){if(0<this.intersectionRatio&&(!g||t(this.target).hasClass("joinchat_force_show")))return d(),m.disconnect(),!1}))})),_.each((function(){m.observe(this)}))),i.use_qr()?i.$(".joinchat__qr").append(i.qr(i.whatsapp_link(void 0,void 0,!1))):i.$(".joinchat__qr").remove(),r&&i.$div.css("--peak","url(#joinchat__message__peak)"),t(n).trigger("joinchat:start"),i.is_ready=!0}():(i.hide(),t(n).on("click",'.joinchat_open, .joinchat_app, a[href="#joinchat"], a[href="#whatsapp"]',(function(e){e.preventDefault(),i.open_whatsapp(t(this).data("phone"),t(this).data("message"))}))),i.can_qr&&!i.is_mobile?t(".joinchat-button__qr").each((function(){t(this).append(i.qr(i.whatsapp_link(t(this).data("phone"),t(this).data("message"),!1)))})):t(".wp-block-joinchat-button figure").remove(),void 0!==i.settings.sku&&(s=i.settings.message_send,t("form.variations_form").on("found_variation reset_data",(function(t,e){e=e&&e.sku||i.settings.sku,i.$(".joinchat__box sku").text(e),i.settings.message_send=s.replace(/<sku>.*<\/sku>/g,e)})))),i.store.setItem("joinchat_views",parseInt(i.store.getItem("joinchat_views")||0)+1)}},t(s),t(e).on("load",s),n.addEventListener("DOMContentLoaded",s)}(jQuery,window,document,window.joinchat_obj||{});